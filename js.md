# JavaScript開発

## はじめに

最近のJSの開発環境は目まぐるしく変わっており、便利にはなっていますが、複雑化も進んでいます。  
`MV*` に代表されるように、サーバーサイドで活用されてきた考え方がクライアントサイドにも導入され、多種多様なFWが現れては消え

「次に流行するFWや考え方は何か？」

といったことは、予想がつかない状況です。

しかしながら、上述した通り、新しいFWや考え方が発表されたとしても共通していることがあります。  
それは、サーバーサイドの様な「関心の分離」を取り入れる事です。  
今後のJS開発をより良いものにしていくため、クライアントサイドにおける「関心の分離」について考えてみましょう。

## FW

- React.js(flux)
- AngularJS
- Knockout
- Vue.js
- Ember.js
- Backbone.js
- ...and more

クライアントサイドフレームワークと呼ばれるものは、本当に多種多様です。  
Rubyの様に、 `RoR` 一択（実際には違うと思いますが）であれば楽なのですが、そうではないので、剪定が重要になってきます。  
実際の業務では `IE` に対応してるかどうかといった事も考えなくてはならず、

- 自分の興味
- 後発のFWだから
- 流行っているから

という理由では選べなかったりします。  

とはいえ、`IE8` のサポートが1月で終了する事もあり、今後は今より自由に選べる様になるかもしれません。
また、クライアントサイドを構築するためのものなので、レンダリングのスピード等も考慮に入れる必要があります。  
画面を部分的に書き換えるといった事においては、 `Backbone.js` が一番速いという計測結果が出ていますが、最近人気のある `React.js` も `Virtual DOM` の採用により、かなりの速さが出ています。

## 関心の分離

所謂 `MV*系` の考え方は、基本的にサーバーサイドの `MVC系` と変わらないと考えています。
ですが、 `データバインディング` という、「データが変われば、表示（ビュー）が切り替わる」という概念が、頭にスッと入ってこない方が多いという印象が強いです。  
ここでは、 `MVVM` という概念を例にとり、説明してみたいと思います。

### MVVM

- Model: モデル(M)
- View: ビュー(V)
- ViewModel: ビューモデル(VM)

に分ける考え方です。

#### M（Model）

サーバーサイドでは、よくDBと紐づけるものと考えられている方が多いみたいなのですが、実際はDBと紐づくものがModelというわけではありません。  
データのやり取りを行うものは、全てModelになります。

では、MVVMではどうでしょうか。

MVVMのModelも、やはりデータのやり取りを行うものになります。  
具体的には、Ajax等によりAPIと通信したり、WEBストレージにデータを保存したりする様な処理をまとめたものがModelとされる事が多いと思います。  
重要なのは、つまり、ここでDOM操作がされる処理を一切書いてはダメという事です。

#### V（View）

テンプレートになります。  
後述するViewModelと紐付けられ、ViewModelの持つ値が変更されると、データバインディングによりViewの内容が自動的に書き換えられます。  
記述方法はFWによって様々だと思いますが、 `Knockout` を例にとると、 `if-else` 等をViewに記述したり、「このViewModelのこのプロパティは、このDOMに紐づくよ」といった指定を書いたりします。  
気づかれたかもしれませんが、基本的にDOMを意識するのはViewのみとなります。  
`jQuery` でガリガリとコードを書かれていた場合、最初はつまづくかもしれません。

また、「ボタンをクリックした」といったイベントが発生した際は、紐付けられたViewModelが持つメソッドを呼び出します。Modelの持つメソッドを直接呼んではいけません。

#### VM（ViewModel）
 
Viewと名前がついていますが、Modelと同様に原則としてDOM操作はViewModelでも行いません。
その代わり、Viewからのイベントを受け取ったり、Modelとデータのやり取りを行います。  
その結果、自身の持つプロパティの状態が変更され、データバインディングによって紐付けられたViewが自動的に変更されます。  
画面が持つ一切のデータが、一旦ViewModelに集約されると考えても良いかと思います。

#### app.js（仮）

いきなり出てきてなんだこれは状態ですが、app.js（形式的にapp.jsとしておきます）は、

「この画面ではこれらのViewModelを使用するんだよ」

といった事を指定する様な実装をしたり、ViewModel同士の連携等を書いたりします。